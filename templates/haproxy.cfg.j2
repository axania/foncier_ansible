global
  daemon
  log 127.0.0.1 local0
  log 127.0.0.1 local1 notice
  maxconn 4096
  tune.ssl.default-dh-param 2048

defaults
  log     global
  mode    http
  option  httplog
  option  dontlognull
  timeout connect 5000
  timeout client  50000
  timeout server  50000

frontend http
  mode http
  bind *:80
  acl auth_ok http_auth(users)
  http-request auth unless auth_ok  
  use_backend foncier_api_back

userlist users
  user {{ haproxy_user }}  insecure-password {{ haproxy_pass }} 
 

backend foncier_api_back
   balance roundrobin
{% for backend in haproxy_backend_servers %}
   server {{ backend.name }} {{ backend.address }} check
{% endfor %}